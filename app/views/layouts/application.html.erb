<!DOCTYPE html>
<html>
  <head>
    <title>Scrap</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="d-flex flex-column min-vh-100">
    <% if user_signed_in? %>
      <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
          <%= link_to "Scrap", dashboard_path, class: "navbar-brand fw-bold" %>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto align-items-center">
              <li class="nav-item">
                <span class="navbar-text me-3 text-white-50">Olá, <strong class="text-white"><%= current_user.email %></strong></span>
              </li>
              <li class="nav-item">
                <%= link_to "Sair", destroy_user_session_path, data: { turbo_method: :delete }, class: "nav-link btn btn-outline-light btn-sm ms-2", style: "border-radius: 8px;" %>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    <% end %>

    <main class="main-content">
      <% unless user_signed_in? %>
        <%# Alertas globais apenas quando não estiver na área de autenticação %>
        <% if notice %>
          <div class="alert alert-success alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3 top-alert" role="alert" style="z-index: 9999; width: 50%; border-radius: 12px; box-shadow: 0 4px 15px rgba(25, 135, 84, 0.3);">
            <%= notice %>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        <% end %>

        <% if alert && controller_name != 'sessions' && controller_name != 'registrations' %>
          <div class="alert alert-danger alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3 top-alert" role="alert" style="z-index: 9999; width: 50%; border-radius: 12px; box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);">
            <%= alert %>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        <% end %>
      <% else %>
        <%# Alertas na área logada %>
        <% if notice %>
          <div class="alert alert-success alert-dismissible fade show top-alert-logged" role="alert" style="border-radius: 12px; box-shadow: 0 4px 15px rgba(25, 135, 84, 0.2);">
            <%= notice %>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        <% end %>

        <% if alert %>
          <div class="alert alert-danger alert-dismissible fade show top-alert-logged" role="alert" style="border-radius: 12px; box-shadow: 0 4px 15px rgba(220, 53, 69, 0.2);">
            <%= alert %>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        <% end %>
      <% end %>

      <%= yield %>
    </main>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
      <div class="loading-content">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
          <span class="visually-hidden">Carregando...</span>
        </div>
        <p class="mt-3 text-white fw-bold">Processando perfil do GitHub...</p>
        <p class="text-white-50 small">Aguarde enquanto fazemos o scraping e consultamos a API</p>
      </div>
    </div>
  </body>
</html>
